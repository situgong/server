The refactoring is **incomplete**. While the code structure is in place, the server fails at runtime because the `rquickjs` engine lacks the `WebAssembly` global object required by the Bergamot glue code (`bergamot-translator.js`).

I will proceed with the following plan to fix the runtime and configure the model:

## 1. Fix Runtime: Polyfill WebAssembly in Rust
The Bergamot JS glue needs `WebAssembly.instantiate` to load the translation engine. I will implement this in `src/wasm_engine.rs` by bridging `rquickjs` (JS) and `wasmtime` (WASM).

- **Use `wasmparser`**: Parse the WASM binary provided by JS to determine the required import signatures (functions, memory).
- **Implement `instantiate`**: 
  - Read `imports` object from JS.
  - Create host functions in `wasmtime` that call back into the provided JS functions.
  - Instantiate the module using `wasmtime`.
  - Expose the WASM exports (memory, functions) back to JS as a `WebAssembly.Instance` object.
- **Implement `WebAssembly.Memory`**: Map JS `WebAssembly.Memory` requests to `wasmtime` linear memory.

## 2. Configure Model Loader
Update `src/wasm_engine.rs` to correctly identify the files in `d:\tools\server\models\enzh`:
- `model.intgemm8.bin` → `model`
- `model.s2t.bin` → `lex`
- `srcvocab.spm` → `srcvocab`
- `trgvocab.spm` → `trgvocab`

## 3. Configure Server Environment
- Update `run_server.ps1` to set `MODELS_DIR=d:\tools\server\models`.

## 4. Verification
- Run the server using `run_server.ps1`.
- Test translation using `curl`.
